from pathlib import Path


configfile: "config/static.yml"


################################################################################
# Paths

conf_paths = config["paths"]
resources_dir = Path(conf_paths["resources"])
results_dir = Path(conf_paths["results"])
scripts_root = Path("workflow/scripts")

log_dir = results_dir / "log" / "{ref_key}"
intermediate_dir = results_dir / "intermediates" / "{ref_key}"
final_dir = results_dir / "final" / "{ref_key}"


def build_abs_path(relpath, basename):
    return str(relpath.resolve() / basename)


envs_path = partial(build_abs_path, Path("workflow/envs"))

################################################################################
# Config (put this in a better spot later)


def lookup_strat(args, wildcards):
    def more(d, *args):
        return d if len(args) == 0 else more(d[args[0]], args[1:])

    return more(config["stratifications"][wildcards.ref_key], args)


################################################################################
# Targets


include: "rules/repseq.smk"
include: "rules/ref.smk"
include: "rules/low_complexity.smk"
include: "rules/xy.smk"
include: "rules/mappability.smk"


rule all:
    input:
        expand(
            rules.all_low_complexity.input + rules.all_xy.input + rules.all_map.input,
            allow_missing=True,
            ref_key=config["stratifications"],
        ),
